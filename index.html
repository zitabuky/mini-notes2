<!doctype html>
<html lang="hu">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mini Notes</title>
  <meta name="theme-color" content="#0f172a" />
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="apple-touch-icon" href="icons/icon-192.png">
  <link rel="icon" href="icons/icon-192.png" sizes="192x192">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      /* Dark (alap) */
      --bg:#0f172a;       /* h√°tt√©r 1 */
      --bg2:#0b1220;      /* h√°tt√©r 2 */
      --panel:#111827;    /* panel */
      --card:#0b1220;     /* k√°rtya */
      --muted:#9ca3af;    /* halv√°ny sz√∂veg */
      --text:#e5e7eb;     /* f≈ë sz√∂veg */
      --brand:#22c55e;    /* gomb sz√≠n */
      --danger:#ef4444;   /* vesz√©ly */
      --border: rgba(255,255,255,.08);
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius: 18px;
    }
    /* Light m√≥d v√°ltoz√≥k */
    body.light{
      --bg:#f8fafc;       /* vil√°gos h√°tt√©r */
      --bg2:#eef2ff;      /* √°tmenet */
      --panel:#ffffff;
      --card:#ffffff;
      --muted:#475569;
      --text:#0f172a;
      --brand:#16a34a;
      --danger:#dc2626;
      --border: rgba(2,6,23,.08);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:Inter,system-ui,Segoe UI,Roboto,Arial;
      background:linear-gradient(120deg,var(--bg2),var(--bg) 40%,var(--bg2));
      color:var(--text); display:grid; place-items:start center; padding:48px 16px;
    }
    .app{width:min(980px,100%)}
    header{display:flex; align-items:center; justify-content:space-between; gap:16px; margin-bottom:22px}
    h1{font-size:clamp(24px,3vw,36px); margin:0; letter-spacing:.3px}
    .subtitle{color:var(--muted); font-size:14px}
    .board{background:rgba(255,255,255,.02); border:1px solid var(--border); border-radius:var(--radius); box-shadow:var(--shadow); padding:20px}
    .composer{display:flex; gap:12px; margin-bottom:16px}
    textarea{flex:1; resize:vertical; min-height:76px; max-height:220px; padding:14px 16px; border-radius:14px; border:1px solid var(--border); background:var(--panel); color:var(--text); outline:none; box-shadow:inset 0 0 0 1px rgba(255,255,255,.02)}
    .row{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
    .btn{appearance:none; border:none; padding:12px 16px; border-radius:14px; cursor:pointer; font-weight:600; background:var(--brand); color:#03120a; transition:.15s transform,.15s filter; box-shadow:0 8px 18px rgba(34,197,94,.25)}
    .btn[disabled]{filter:grayscale(1) brightness(.8); cursor:not-allowed}
    .btn.secondary{background:#1f2937; color:#d1d5db; box-shadow:inset 0 0 0 1px var(--border); border:1px solid var(--border)}
    .search{margin-left:auto; display:flex; align-items:center; gap:8px; background:#0d1526; padding:10px 12px; border-radius:12px; border:1px solid var(--border)}
    body.light .search{background:#ffffff}
    .search input{background:transparent; border:none; outline:none; color:var(--text); min-width:180px}
    .grid{display:grid; grid-template-columns:repeat(auto-fill,minmax(260px,1fr)); gap:14px}
    .card{background:var(--card); border:1px solid var(--border); border-radius:16px; padding:14px; display:flex; flex-direction:column; gap:12px; position:relative}
    .badge{font-size:12px; color:#a3e635; background:rgba(163,230,53,.08); padding:4px 8px; border-radius:999px; width:max-content}
    .note{white-space:pre-wrap; line-height:1.45}
    .meta{display:flex; justify-content:space-between; align-items:center; gap:8px; color:var(--muted); font-size:12px}
    .actions{display:flex; gap:8px}
    .iconbtn{background:#111827; border:1px solid var(--border); color:#e5e7eb; border-radius:10px; padding:8px 10px; cursor:pointer}
    body.light .iconbtn{background:#ffffff; color:#0f172a}
    .iconbtn.danger{background:#1b0f12; border-color:rgba(239,68,68,.35); color:#fecaca}
    .empty{padding:30px; text-align:center; color:var(--muted)}
    footer{margin-top:18px; color:var(--muted); font-size:12px; text-align:center}
    a{color:#86efac}
    .install{position:fixed; right:18px; bottom:18px; display:none}
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div>
        <h1>Mini Notes</h1>
        <div class="subtitle">Egyszer≈± jegyzet-app <strong>localStorage</strong>-szal. PWA-k√©nt telep√≠thet≈ë.</div>
      </div>
      <div style="display:flex; align-items:center; gap:8px; margin-left:auto">
        <div class="search" title="Keres√©s a jegyzetek k√∂z√∂tt">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M21 21l-3.8-3.8" stroke="#9ca3af" stroke-width="2" stroke-linecap="round"/><circle cx="11" cy="11" r="7" stroke="#9ca3af" stroke-width="2"/></svg>
          <input id="q" placeholder="Keres√©s... (Ctrl+/)" />
        </div>
        <button id="themeBtn" class="btn secondary" title="T√©ma v√°lt√°sa">üåô S√∂t√©t m√≥d</button>
      </div>
    </header>

    <section class="board">
      <div class="composer">
        <textarea id="input" placeholder="√çrj egy jegyzetet‚Ä¶ (Ctrl+Enter a ment√©shez)"></textarea>
      </div>
      <div class="row">
        <button class="btn" id="add">+ Jegyzet ment√©se</button>
        <button class="btn secondary" id="clear">√ñsszes t√∂rl√©se</button>
        <span class="subtitle" id="count"></span>
      </div>
    </section>

    <section style="margin-top:16px">
      <div id="list" class="grid"></div>
      <div id="empty" class="empty" hidden>M√©g nincs jegyzet. Kezdd el fent, √©s itt fognak megjelenni. ‚úçÔ∏è</div>
    </section>

    <footer>Made with ‚ô• ‚Äì tanul√≥ projekt. Forr√°sk√≥d a b√∂ng√©sz≈ëben fut.</footer>
  </div>

  <button id="installBtn" class="btn install">Telep√≠t√©s a kezd≈ëk√©perny≈ëre</button>

  <script>
    // --- T√âMA KEZEL√âS ---
    const THEME_KEY = 'mini-notes:theme';
    const mTheme = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)');
    function applyTheme(t){
      const theme = t || localStorage.getItem(THEME_KEY) || (mTheme && mTheme.matches ? 'dark' : 'light');
      document.body.classList.toggle('light', theme==='light');
      localStorage.setItem(THEME_KEY, theme);
      const btn = document.getElementById('themeBtn');
      if(btn){ btn.textContent = theme==='light' ? 'üåô S√∂t√©t m√≥d' : '‚òÄÔ∏è Vil√°gos m√≥d'; }
      const meta = document.querySelector('meta[name="theme-color"]');
      if(meta){ meta.setAttribute('content', getComputedStyle(document.body).getPropertyValue('--bg').trim()); }
      return theme;
    }
    function toggleTheme(){
      const current = localStorage.getItem(THEME_KEY) || (mTheme && mTheme.matches ? 'dark' : 'light');
      applyTheme(current==='light' ? 'dark' : 'light');
    }

    // --- Alap √°llapot ---
    const LS_KEY = 'mini-notes:v1';
    const $ = sel => document.querySelector(sel);
    const state = { notes: [], query: '', deferredPrompt: null };

    function load(){
      try{ state.notes = JSON.parse(localStorage.getItem(LS_KEY)) || []; }
      catch(e){ state.notes = []; }
    }
    function save(){ localStorage.setItem(LS_KEY, JSON.stringify(state.notes)); render(); }
    function addNote(text){ text=(text||'').trim(); if(!text) return; state.notes.unshift({ id: crypto.randomUUID(), text, ts: Date.now() }); save(); $('#input').value=''; $('#input').focus(); }
    function updateNote(id, newText){ const n = state.notes.find(n=>n.id===id); if(!n) return; n.text = newText.trim(); save(); }
    function deleteNote(id){ state.notes = state.notes.filter(n=>n.id!==id); save(); }
    function clearAll(){ if(confirm('Biztosan t√∂rl√∂d az √∂sszes jegyzetet?')){ state.notes = []; save(); } }
    function formatDate(ts){ const d=new Date(ts); return d.toLocaleString('hu-HU',{dateStyle:'medium', timeStyle:'short'}); }
    function filtered(){ const q=state.query.toLowerCase(); return !q? state.notes : state.notes.filter(n=> n.text.toLowerCase().includes(q)); }

    function render(){
      const notes = filtered();
      $('#count').textContent = `${notes.length} jegyzet`;
      $('#empty').hidden = notes.length !== 0;
      const html = notes.map(n=>`
        <article class="card" data-id="${n.id}">
          <span class="badge">#${state.notes.indexOf(n)+1}</span>
          <div class="note" contenteditable="true" spellcheck="true">${n.text.replace(/</g,'&lt;')}</div>
          <div class="meta">
            <span>${formatDate(n.ts)}</span>
            <div class="actions">
              <button class="iconbtn" data-act="copy">M√°sol√°s</button>
              <button class="iconbtn danger" data-act="del">T√∂rl√©s</button>
            </div>
          </div>
        </article>`).join('');
      $('#list').innerHTML = html;
    }

    // Esem√©nyek
    document.getElementById('themeBtn')?.addEventListener('click', toggleTheme);
    $('#add').addEventListener('click', () => addNote($('#input').value));
    $('#clear').addEventListener('click', clearAll);
    $('#input').addEventListener('keydown', (e)=>{ if(e.key==='Enter' && (e.ctrlKey||e.metaKey)){ addNote($('#input').value); } });
    $('#q').addEventListener('input', e=>{ state.query = e.target.value; render(); });
    document.addEventListener('keydown', (e)=>{ if(e.key==='/' && (e.ctrlKey||e.metaKey)){ e.preventDefault(); $('#q').focus(); } });
    $('#list').addEventListener('input', (e)=>{ const art=e.target.closest('.card'); if(!art) return; if(e.target.classList.contains('note')){ updateNote(art.dataset.id, e.target.textContent); } });
    $('#list').addEventListener('click', async (e)=>{
      const btn=e.target.closest('button'); if(!btn) return; const art=btn.closest('.card'); const id=art.dataset.id; const act=btn.dataset.act;
      if(act==='del') deleteNote(id);
      if(act==='copy'){ const text=art.querySelector('.note').textContent; try{ await navigator.clipboard.writeText(text); btn.textContent='M√°solva ‚úì'; setTimeout(()=>btn.textContent='M√°sol√°s',1200);}catch{} }
    });

    // --- PWA: Service Worker + A2HS ---
    if('serviceWorker' in navigator){ navigator.serviceWorker.register('sw.js').catch(()=>{}); }
    window.addEventListener('beforeinstallprompt', (e)=>{
      e.preventDefault(); state.deferredPrompt = e; const btn=document.getElementById('installBtn'); btn.style.display='inline-block'; btn.onclick=async()=>{ btn.disabled=true; if(state.deferredPrompt){ state.deferredPrompt.prompt(); await state.deferredPrompt.userChoice; state.deferredPrompt=null;} btn.style.display='none'; };
    });

    // Init
    applyTheme();
    load();
    render();
  </script>
     <footer>Made with ‚ô• ‚Äì tanul√≥ projekt. Forr√°sk√≥d a b√∂ng√©sz≈ëben fut.</footer>
</div>

<button id="installBtn" class="btn install">Telep√≠t√©s a kezd≈ëk√©perny≈ëre</button>

<!-- A SAJ√ÅT (nem modul) script BLOKK v√©ge -->
</script>

<!-- Firebase SZINKRON ‚Äì k√ºl√∂n modul scriptk√©nt! -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import {
    getFirestore, collection, addDoc, deleteDoc, updateDoc, doc,
    onSnapshot, query, orderBy, enableIndexedDbPersistence
  } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

  // A TE webappod Firebase konfigur√°ci√≥ja
  const firebaseConfig = {
    apiKey: "AIzaSyAdJ5cSpgyk1DhlLqFhKeSHFCamrQHS7Ko",
    authDomain: "mini-notes-266b2.firebaseapp.com",
    projectId: "mini-notes-266b2",
    storageBucket: "mini-notes-266b2.firebasestorage.app",
    messagingSenderId: "859437610641",
    appId: "1:859437610641:web:7cd2a7447800954120b130"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  enableIndexedDbPersistence(db).catch(()=>{}); // offline cache

  // Firestore: 'notes' gy≈±jtem√©ny, 'text' mez≈ë
  const coll = collection(db, "notes");
  const q = query(coll, orderBy("ts", "desc"));

  // Firestore -> UI (√©l≈ë)
  onSnapshot(q, (snap) => {
    state.notes = snap.docs.map(d => ({ id: d.id, ...d.data() }));
    render();
  });

  // UI -> Firestore (fel√ºl√≠rjuk a lok√°l f√ºggv√©nyeket)
  window.addNote = async (text) => {
    text = (text || "").trim(); if (!text) return;
    await addDoc(coll, { text, ts: Date.now() });
    document.getElementById('input').value = '';
    document.getElementById('input').focus();
  };
  window.updateNote = async (id, newText) =>
    updateDoc(doc(db, "notes", id), { text: (newText || "").trim() });
  window.deleteNote = async (id) =>
    deleteDoc(doc(db, "notes", id));
  window.clearAll = async () => {
    if (!confirm('Biztosan t√∂rl√∂d az √∂sszes jegyzetet?')) return;
    await Promise.all(state.notes.map(n => deleteDoc(doc(db, "notes", n.id))));
  };
</script>
</body>
</html>




